# FlowDeploy Backend Environment Configuration
# Copy this file to .env and adjust values for your environment

# =============================================================================
# Server
# =============================================================================
# Environment: development, staging, production
# In development, logs are colorized; in production, logs are JSON
APP_ENV=development

# Host address to bind the server (0.0.0.0 = all interfaces)
HOST=0.0.0.0

# Port for the HTTP API server
PORT=8080

# Logging verbosity: debug, info, warn, error
LOG_LEVEL=info

# CORS allowed origins (comma-separated)
# Use specific origins for production (e.g., "https://deploy.connexto.com.br")
# Use "*" for development (allows all origins, but disables credentials)
CORS_ORIGINS=*

# =============================================================================
# Database
# =============================================================================
# PostgreSQL connection string
# Format: postgres://user:password@host:port/database?sslmode=disable
DATABASE_URL=postgres://paas_deploy:paas_deploy@localhost:5432/paas_deploy?sslmode=disable

# =============================================================================
# Deploy Engine
# =============================================================================
# Directory where application repositories are cloned and stored
# Supports: ~ (home), $HOME, absolute paths
# Default (if not set): ~/.paas-deploy/apps
DEPLOY_DATA_DIR=~/.paas-deploy/apps

# Number of concurrent deploy workers (parallel deployments)
DEPLOY_WORKERS=2

# Maximum time (seconds) allowed for a complete deploy operation
DEPLOY_TIMEOUT=600

# Maximum time (seconds) to wait for health check response
HEALTH_CHECK_TIMEOUT=60

# Number of health check retry attempts before marking deploy as failed
HEALTH_CHECK_RETRIES=3

# =============================================================================
# gRPC
# =============================================================================
# Enable gRPC server for agent connections
GRPC_ENABLED=false

# Backend gRPC port
GRPC_PORT=50051

# Public address reachable by agents (host:port)
GRPC_SERVER_ADDR=

# Path to agent binary for provisioning
AGENT_BINARY_PATH=

# Agent gRPC port used for health checks and deploy control
AGENT_GRPC_PORT=50052

# =============================================================================
# Docker
# =============================================================================
# Docker daemon socket path
DOCKER_HOST=unix:///var/run/docker.sock

# Docker registry URL for pushing built images (optional, leave empty for local)
# DOCKER_REGISTRY=registry.example.com

# =============================================================================
# GitHub Integration (Phase 1 - PAT)
# =============================================================================
# GitHub Personal Access Token for API access (scopes: repo, admin:repo_hook)
# Generate at: https://github.com/settings/tokens
# GIT_HUB_PAT=ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# Webhook secret for HMAC signature validation
# Generate with: openssl rand -hex 32
GIT_HUB_WEBHOOK_SECRET=your-webhook-secret-here

# Public URL where GitHub will send webhook events
# Example: https://deploy.yourdomain.com/paas-deploy/v1/webhooks/github
GIT_HUB_WEBHOOK_URL=

# =============================================================================
# GitHub OAuth (for user authentication)
# =============================================================================
# OAuth Client ID (from GitHub App settings)
GIT_HUB_CLIENT_ID=Iv1.xxxxxxxxxxxxxxxxxx

# OAuth Client Secret (from GitHub App settings)
GIT_HUB_CLIENT_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# OAuth callback URL (must match GitHub App settings)
GIT_HUB_OAUTH_CALLBACK_URL=http://localhost:3000/auth/github/callback

# =============================================================================
# GitHub App (for repository access)
# =============================================================================
# App ID (found on GitHub App settings page)
GIT_HUB_APP_ID=123456

# App Name (for display purposes)
GIT_HUB_APP_NAME=FlowDeploy

# Private key path (downloaded .pem file from GitHub App settings)
GIT_HUB_APP_PRIVATE_KEY_PATH=/path/to/private-key.pem

# Alternative: Base64 encoded private key (use one or the other)
# GIT_HUB_APP_PRIVATE_KEY_BASE64=LS0tLS1CRUdJTi...

# URL to install the GitHub App (redirect users here)
GIT_HUB_APP_INSTALL_URL=https://github.com/apps/flowdeployapp/installations/new

# URL where GitHub redirects after installation
GIT_HUB_APP_SETUP_URL=http://localhost:3000/github/setup

# =============================================================================
# Authentication & Security
# =============================================================================
# Token encryption key (32 bytes, base64 encoded)
# Generate with: openssl rand -base64 32
TOKEN_ENCRYPTION_KEY=your-32-byte-key-base64-encoded-here

# Session cookie name
SESSION_COOKIE_NAME=flowdeploy_session

# Session max age in seconds (default: 7 days)
SESSION_MAX_AGE=604800

# Use secure cookies (set to true in production with HTTPS)
SESSION_SECURE=false

# Cookie domain for cross-subdomain authentication
# Set to parent domain (e.g., ".connexto.com.br") when frontend and backend are on different subdomains
# Leave empty for same-domain deployments
COOKIE_DOMAIN=

# Frontend URL (for redirects after OAuth)
FRONTEND_URL=http://localhost:3000

CLOUDFLARE_CLIENT_ID=      # Opcional (para OAuth futuro)
CLOUDFLARE_CLIENT_SECRET=  # Opcional (para OAuth futuro)
CLOUDFLARE_CALLBACK_URL=   # Opcional (para OAuth futuro)
CLOUDFLARE_SERVER_IP=191.252.203.58      # IP do servidor para registros A
CLOUDFLARE_DEFAULT_DOMAIN= # Domínio padrão para CNAME