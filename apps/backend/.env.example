# FlowDeploy Backend Environment Configuration
# Copy this file to .env and adjust values for your environment

# =============================================================================
# Server
# =============================================================================
# Environment: development, staging, production
# In development, logs are colorized; in production, logs are JSON
APP_ENV=development

# Host address to bind the server (0.0.0.0 = all interfaces)
HOST=0.0.0.0

# Port for the HTTP API server
PORT=8080

# Logging verbosity: debug, info, warn, error
LOG_LEVEL=info

# =============================================================================
# Database
# =============================================================================
# PostgreSQL connection string
# Format: postgres://user:password@host:port/database?sslmode=disable
DATABASE_URL=postgres://paas_deploy:paas_deploy@localhost:5432/paas_deploy?sslmode=disable

# =============================================================================
# Deploy Engine
# =============================================================================
# Directory where application repositories are cloned and stored
# Supports: ~ (home), $HOME, absolute paths
# Default (if not set): ~/.paas-deploy/apps
DEPLOY_DATA_DIR=~/.paas-deploy/apps

# Number of concurrent deploy workers (parallel deployments)
DEPLOY_WORKERS=2

# Maximum time (seconds) allowed for a complete deploy operation
DEPLOY_TIMEOUT=600

# Maximum time (seconds) to wait for health check response
HEALTH_CHECK_TIMEOUT=60

# Number of health check retry attempts before marking deploy as failed
HEALTH_CHECK_RETRIES=3

# =============================================================================
# Docker
# =============================================================================
# Docker daemon socket path
DOCKER_HOST=unix:///var/run/docker.sock

# Docker registry URL for pushing built images (optional, leave empty for local)
# DOCKER_REGISTRY=registry.example.com

# =============================================================================
# GitHub Integration (Phase 1 - PAT)
# =============================================================================
# GitHub Personal Access Token for API access (scopes: repo, admin:repo_hook)
# Generate at: https://github.com/settings/tokens
# GITHUB_PAT=ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# Webhook secret for HMAC signature validation
# Generate with: openssl rand -hex 32
GITHUB_WEBHOOK_SECRET=your-webhook-secret-here

# Public URL where GitHub will send webhook events
# Example: https://deploy.yourdomain.com/paas-deploy/v1/webhooks/github
GITHUB_WEBHOOK_URL=

# =============================================================================
# GitHub OAuth (for user authentication)
# =============================================================================
# OAuth Client ID (from GitHub App settings)
GITHUB_CLIENT_ID=Iv1.xxxxxxxxxxxxxxxxxx

# OAuth Client Secret (from GitHub App settings)
GITHUB_CLIENT_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# OAuth callback URL (must match GitHub App settings)
GITHUB_OAUTH_CALLBACK_URL=http://localhost:3000/auth/github/callback

# =============================================================================
# GitHub App (for repository access)
# =============================================================================
# App ID (found on GitHub App settings page)
GITHUB_APP_ID=123456

# App Name (for display purposes)
GITHUB_APP_NAME=FlowDeploy

# Private key path (downloaded .pem file from GitHub App settings)
GITHUB_APP_PRIVATE_KEY_PATH=/path/to/private-key.pem

# Alternative: Base64 encoded private key (use one or the other)
# GITHUB_APP_PRIVATE_KEY_BASE64=LS0tLS1CRUdJTi...

# URL to install the GitHub App (redirect users here)
GITHUB_APP_INSTALL_URL=https://github.com/apps/flowdeployapp/installations/new

# URL where GitHub redirects after installation
GITHUB_APP_SETUP_URL=http://localhost:3000/github/setup

# =============================================================================
# Authentication & Security
# =============================================================================
# Token encryption key (32 bytes, base64 encoded)
# Generate with: openssl rand -base64 32
TOKEN_ENCRYPTION_KEY=your-32-byte-key-base64-encoded-here

# Session cookie name
SESSION_COOKIE_NAME=flowdeploy_session

# Session max age in seconds (default: 7 days)
SESSION_MAX_AGE=604800

# Use secure cookies (set to true in production with HTTPS)
SESSION_SECURE=false

# Frontend URL (for redirects after OAuth)
FRONTEND_URL=http://localhost:3000
